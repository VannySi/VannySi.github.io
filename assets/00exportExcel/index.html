<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>导出Excel</title>
  <style>
    .demo div {
      cursor: pointer;
      display: inline-block;
      width: 80px;
      height: 32px;
      line-height: 32px;
      text-align: center;
      margin-left: 20px;
      border: 1px solid #acacac;
      border-radius: 4px;
    }
  </style>
</head>
<body class="demo">
  <h3>简单</h3>
  <div onclick="exportSimple()">导出</div>
  <h3>样式</h3>
  <div onclick="exportStyle()">导出</div>
  <h3>Sheets</h3>
  <div onclick="exportSheet()">导出</div>
  <h3>其它</h3>
  <div id="down1">下载1</div>
  <div id="down2">下载2</div>
  <script src="./data.js"></script>
  <script src="./index.js"></script>

  <script>
    function exportSimple() {
      var result = excelPreset.init({
        column: ['a', 'b', 'c'],
        source: [
          { a: 232, b: 291, c: 232 },
          { a: 343, b: 862, c: 247 },
          { a: 136, b: 974, c: 124 },
          { a: 212, b: 976, c: 'due' },
        ],
      });
      excelPreset.export({ list: result });
    }
    function exportStyle() {
      var result = excelPreset.init({
        column: ['a', 'b', 'c'],
        source: [
          { a: 232, b: 291, c: 232 },
          { a: 343, b: 862, c: 247 },
          { a: 136, b: 974, c: 124 },
          { a: 212, b: 976, c: 'due' },
        ],
        config: { // 公共配置，即总体配置
          '!merges': [ // 合并单元格
            {
              s: { c: 3, r: 1 }, // 开始：从 D2 开始
              e: { c: 4, r: 2 }, // 结束：到 F4 结束
            },
          ],
          D2: { // D2 样式
            s: {
              font: {
                color: { rgb: 'D37600' }, // 字体颜色 
                sz: 16, // 字体大小
              }
            },
          },
        },
        position: [2, 1], // 偏移量，从 C2 开始
        getCellRender: function(row, col) {
          return {
            s: { 
              // 每个单元格都一样
              border: {
                top: { style: 'thin' },
                bottom: { style: 'thin' },
                left: { style: 'thin' },
                right: { style: 'thin' },
              },
              // 根据行列不同配置不同样式
              fill: { fgColor: { rgb: col > 3 && row > 5 ? 'FFFFCD' : 'FFFFFF' } },
              // 每个单元格都一样
              alignment: { horizontal: 'center', vertical: 'center' },
            },
          }
        },
      });
      excelPreset.export({ list: result });
    }
    function exportSheet() {
      var data = {
        column: ['a', ['b', function(v) { return v || parseInt(Math.random() * 100, 10) }], 'c'],
        source: [
          { a: 232, b: 0, c: 232 },
          { a: 343, b: 0, c: 0 },
          { a: 136, b: 0, c: 124 },
          { a: 212, b: 0, c: 'due' },
        ],
      };
      var list = [];
      for (var i = 0; i < 3; i += 1) {
        list.push(excelPreset.init(data));
      }
      excelPreset.export({
        name: '这有Excel有多个Sheet',
        tags: 'hhhhhh',
        list: list,
      });
    }
    document.getElementById('down1').addEventListener('click', function() {
      var source = [
        { unit: '监测设备运行统计' },
        { unit: '单位', xhOrgNum: '鑫辉物联', hrOrgNum: '恒瑞电气', ccOrgNum: '巢巢科技', xdOrgNum: '兴达电器', collectOrgNum: '总计' },
        { unit: '单位', xhOrgNum: '企业数量', xhSetNum: '套数', hrOrgNum: '企业数量', hrSetNum: '套数', ccOrgNum: '企业数量',
          ccSetNum: '套数', xdOrgNum: '企业数量', xdSetNum: '套数', collectOrgNum: '企业数量', collectSetNum: '套数' },
      ].concat(body);
      source.push({ unit: '截止XX月XX日，余杭区...' });
      var keys = ['unit', 'xhOrgNum', 'xhSetNum', 'hrOrgNum', 'hrSetNum', 'ccOrgNum', 'ccSetNum', 'xdOrgNum', 'xdSetNum', 'collectOrgNum', 'collectSetNum'];

      var result = excelPreset.init({
        column: keys,
        source: source,
        config: {
          '!merges': [
            { s: { c: 1, r: 0 }, e: { c: 11, r: 0 } },
            { s: { c: 1, r: 1 }, e: { c: 1, r: 2 } },
            { s: { c: 2, r: 1 }, e: { c: 3, r: 1 } },
            { s: { c: 4, r: 1 }, e: { c: 5, r: 1 } },
            { s: { c: 6, r: 1 }, e: { c: 7, r: 1 } },
            { s: { c: 8, r: 1 }, e: { c: 9, r: 1 } },
            { s: { c: 10, r: 1 }, e: { c: 11, r: 1 } },
            {
              s: { c: 1, r: body.length + 3 },
              e: { c: 11, r: body.length + 3 },
            },
          ],
          B1: {
            s: {
              font: { color: { rgb: 'D37600' }, sz: 16 }
            },
          },
        },
        getCellRender: getCellStyle,
        position: [1, 0],
      });
      excelPreset.export({ list: result });
    });
    document.getElementById('down2').addEventListener('click', function() {
      var source1 = [
        { unit: '监测设备运行统计' },
        { unit: '单位', xhOrgNum: '鑫辉物联', hrOrgNum: '恒瑞电气', ccOrgNum: '巢巢科技', xdOrgNum: '兴达电器', collectOrgNum: '总计' },
        { unit: '单位', xhOrgNum: '企业数量', xhSetNum: '套数', hrOrgNum: '企业数量', hrSetNum: '套数', ccOrgNum: '企业数量',
          ccSetNum: '套数', xdOrgNum: '企业数量', xdSetNum: '套数', collectOrgNum: '企业数量', collectSetNum: '套数' },
      ].concat(body);
      source1.push({ unit: '截止XX月XX日，余杭区...' });
      var keys1 = ['unit', 'xhOrgNum', 'xhSetNum', 'hrOrgNum', 'hrSetNum', 'ccOrgNum', 'ccSetNum', 'xdOrgNum', 'xdSetNum', 'collectOrgNum', 'collectSetNum'];

      var result1 = excelPreset.init({
        column: keys1,
        source: source1,
        config: {
          '!merges': [
            { s: { c: 1, r: 0 }, e: { c: 11, r: 0 } },
            { s: { c: 1, r: 1 }, e: { c: 1, r: 2 } },
            { s: { c: 2, r: 1 }, e: { c: 3, r: 1 } },
            { s: { c: 4, r: 1 }, e: { c: 5, r: 1 } },
            { s: { c: 6, r: 1 }, e: { c: 7, r: 1 } },
            { s: { c: 8, r: 1 }, e: { c: 9, r: 1 } },
            { s: { c: 10, r: 1 }, e: { c: 11, r: 1 } },
            {
              s: { c: 1, r: body.length + 3 },
              e: { c: 11, r: body.length + 3 },
            },
          ],
          B1: {
            s: {
              font: { color: { rgb: 'D37600' }, sz: 16 }
            },
          },
        },
        getCellRender: getCellStyle,
        position: [1, 0],
      });
      var source = [
        { unit: '本月监测设备运行统计:' },
        { unit: '街道', xdOrgNum: '兴达电器' , xhOrgNum: '鑫辉物联', hrOrgNum: '恒瑞电气', ccOrgNum: '巢巢科技', collectOrgNum: '汇总'},
        { unit: '街道', xdOrgNum: '企业数量', xdSetNum: '套数', xhOrgNum: '企业数量', xhSetNum: '套数', hrOrgNum: '企业数量', hrSetNum: '套数', ccOrgNum: '企业数量',
          ccSetNum: '套数', collectOrgNum: '企业数量', collectSetNum: '套数' },
      ].concat(body);
      source.push({ unit: '本月余杭区智慧用电共新安装企业数' });
      source.push({});
      var keys = [
        'unit',
        ['xhOrgNum', function(cell, row) {
          return typeof cell === 'number' ? (cell + Math.random()).toFixed(2) : cell;
        }],
        'xhSetNum', 'hrOrgNum', 'hrSetNum', 'ccOrgNum', 'ccSetNum',
        'xdOrgNum', 'xdSetNum', 'collectOrgNum', 'collectSetNum',
      ];
      
      var config = {
        '!merges': [
          { s: { c: 2, r: 1 }, e: { c: 12, r: 1 } },
          { s: { c: 2, r: 2 }, e: { c: 2, r: 3 } },
          { s: { c: 3, r: 2 }, e: { c: 4, r: 2 } },
          { s: { c: 5, r: 2 }, e: { c: 6, r: 2 } },
          { s: { c: 7, r: 2 }, e: { c: 8, r: 2 } },
          { s: { c: 9, r: 2 }, e: { c: 10, r: 2 } },
          { s: { c: 11, r: 2 }, e: { c: 12, r: 2 } },
          {
            s: { c: 2, r: body.length + 4 },
            e: { c: 12, r: body.length + 5 },
          },
        ],
        C2: {
          s: {
            font: { color: { rgb: 'D37600' }, sz: 11 }
          },
        },
      };
      var result = excelPreset.init({
        column: keys,
        source: source,
        config: config,
        getCellRender: getCellStyle,
        position: [2, 1],
      });
      excelPreset.export({
        name: '这有excel两页',
        tags: 'hhhhhh',
        list: [result, result1],
      });
    });
    function getCellStyle(row, col) {
      return {
        s: {
          border: {
            top: { style: 'thin' },
            bottom: { style: 'thin' },
            left: { style: 'thin' },
            right: { style: 'thin' },
          },
          fill: { fgColor: { rgb: col > 1 && row > 3 ? 'FFFFCD' : 'FFFFFF' } },
          alignment: { horizontal: 'center', vertical: 'center' },
        },
      }
    }
  </script>
</body>
</html>